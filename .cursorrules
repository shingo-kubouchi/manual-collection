# Cursor Rules for Manual Collection Project

このファイルは、Cursor AIがプロジェクトを理解し、適切な開発支援を行うためのルールを定義します。

## プロジェクト概要

説明書管理アプリケーション - Notion APIを使用して製品の説明書を管理するサーバーレスアプリケーション

## 開発フロー

新機能を追加する際は、以下の手順に従ってください：

1. **`DEVELOPMENT.md`を確認**
   - 既存の実装履歴を確認
   - 類似のエラーや解決方法を確認
   - アーキテクチャを理解

2. **要件定義**
   - 機能の目的と要件を明確にする
   - 既存の機能との整合性を確認

3. **設計**
   - データ構造の設計（`lib/types.ts`を確認）
   - API設計（既存のAPI Routesを参考）
   - UI/UX設計（既存のコンポーネントを参考）

4. **実装**
   - 型定義の追加（`lib/types.ts`）
   - API Routeの実装（`app/api/`）
   - コンポーネントの実装（`app/components/`）
   - ページの実装（`app/`）

5. **エラーハンドリング**
   - 適切なエラーメッセージの表示
   - セキュリティ: 機密情報をエラーメッセージに含めない

6. **ドキュメント更新**
   - `README.md`の更新（必要に応じて）
   - `DEVELOPMENT.md`の「実装履歴」に記録

## コーディング規約

### TypeScript
- 型安全性を重視
- `any`型の使用は最小限に
- インターフェースは`lib/types.ts`に定義

### React/Next.js
- コンポーネントは`app/components/`に配置
- ページは`app/`に配置
- クライアントコンポーネントには`"use client"`を追加
- `useSearchParams()`は`Suspense`でラップ

### API Routes
- 動的ルートの`params`は`Promise`型（Next.js 16）
- エラーハンドリングを適切に実装
- セキュリティヘッダーを設定

### 認証
- NextAuth.js v5を使用
- 認証が必要なページは`middleware.ts`で保護
- 環境変数は`.env.local`に設定（本番はVercelの環境変数）

## エラー解決時の手順

1. **エラーメッセージを確認**
   - エラーの種類と場所を特定

2. **`DEVELOPMENT.md`の「エラー解決履歴」を確認**
   - 類似のエラーがないか確認
   - 解決方法を参考にする

3. **原因の調査**
   - 関連するコードの確認
   - 環境変数の確認
   - 依存関係の確認

4. **修正の実装**
   - 最小限の変更で修正
   - エラーハンドリングの追加

5. **記録**
   - `DEVELOPMENT.md`の「エラー解決履歴」に記録

## 環境変数

### 開発環境
- `.env.local`ファイルに設定
- `$`で始まる値（bcryptハッシュ）はBase64エンコードして`HASHED_PASSWORD_B64`として保存

### 本番環境（Vercel）
- Vercelダッシュボードで環境変数を設定
- `HASHED_PASSWORD_B64`を使用（`$`で始まる値の問題を回避）

## よくある問題

### 環境変数が読み込まれない
- 開発サーバーを再起動
- `.env.local`の構文を確認（引用符で囲む）
- `$`で始まる値はBase64エンコードを使用

### Next.js 16の型エラー
- 動的ルートの`params`は`Promise`型
- `useSearchParams()`は`Suspense`でラップ

### Vercelデプロイエラー
- `vercel.json`を確認
- `public`ディレクトリが存在するか確認
- 環境変数が正しく設定されているか確認

## 参考ファイル

- `DEVELOPMENT.md`: 開発履歴とエラー解決方法
- `README.md`: プロジェクトの概要とセットアップ手順
- `auth.ts`: NextAuth.js設定
- `lib/types.ts`: 型定義
- `lib/notion.ts`: Notion API連携

## 注意事項

- セキュリティ: 機密情報をコードに含めない
- エラーメッセージ: ユーザーに分かりやすいメッセージを表示
- 型安全性: TypeScriptの型チェックを活用
- ドキュメント: 変更は必ず`DEVELOPMENT.md`に記録

