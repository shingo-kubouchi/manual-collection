# 説明書管理アプリ

製品の説明書をNotionで管理するサーバーレスアプリケーションです。説明書のURLや画像、購入日、カテゴリなどの情報を保存・管理できます。

## 機能

- 📚 説明書のURLまたは画像を保存
- 📷 カメラで説明書を撮影してアップロード（モバイル対応）
- 📅 購入日とカテゴリで整理
- 🔍 一覧表示で簡単に検索
- ✏️ 説明書の編集・削除

## 技術スタック

- **フロントエンド**: Next.js 14 (App Router), React, TypeScript
- **スタイリング**: Tailwind CSS
- **バックエンド**: Vercel Serverless Functions
- **データベース**: Notion API
- **ホスティング**: Vercel（無料枠対応）

## セットアップ手順

### 1. 依存関係のインストール

```bash
npm install
```

### 2. Notion Integrationの作成

1. [Notion Integrations](https://www.notion.so/my-integrations) にアクセス
2. 「+ New integration」をクリック
3. 名前を入力（例: "説明書管理アプリ"）
4. 「Submit」をクリック
5. 「Internal Integration Token」をコピー（`secret_`で始まる文字列）

### 3. Notionデータベースの作成

#### ステップ1: データベースの作成

1. Notionで新しいページを作成
2. `/database` と入力して「Table - Inline」を選択
3. テーブルが作成されます（初期状態では「Name」という列が1つあります）

#### ステップ2: プロパティ（列）の設定

テーブルの上部にある列ヘッダーをクリックして、以下のプロパティを順番に作成します：

**既存の「Name」列を「製品名」に変更：**
1. 「Name」列のヘッダーをクリック
2. 「Rename」を選択
3. 「製品名」に変更
4. タイプは「Title」のまま（変更不要）

**新しいプロパティを追加：**
テーブルの右端にある「+」ボタンをクリックして、以下のプロパティを追加します：

1. **説明書URL**
   - 「+」ボタンをクリック
   - プロパティ名に「説明書URL」と入力
   - タイプで「URL」を選択
   - 「Done」をクリック

2. **説明書画像**
   - 「+」ボタンをクリック
   - プロパティ名に「説明書画像」と入力
   - タイプで「Files & media」を選択
   - 「Done」をクリック

3. **購入日**
   - 「+」ボタンをクリック
   - プロパティ名に「購入日」と入力
   - タイプで「Date」を選択
   - 「Done」をクリック

4. **カテゴリ**
   - 「+」ボタンをクリック
   - プロパティ名に「カテゴリ」と入力
   - タイプで「Select」を選択
   - 「Done」をクリック
   - （オプション）カテゴリの選択肢を追加する場合：
     - 「カテゴリ」列のセルをクリック
     - 「Add an option」から「家電」「家具」「食品」などを追加

**自動プロパティ（既に存在する場合があります）：**
- **作成日**: タイプが「Created time」のプロパティ（自動で存在する場合あり）
- **更新日**: タイプが「Last edited time」のプロパティ（自動で存在する場合あり）

もし存在しない場合は、同様に「+」ボタンから追加してください。

#### ステップ3: データベースIDの取得

**重要**: データベースIDの取得方法には2つのパターンがあります。

**方法A: URLから直接取得（推奨）**

1. データベースページのURLをコピー
   - 例: `https://www.notion.so/2db00d36-98bc-80d0-9bd0-c449fbb26645?v=...`
2. URLの中の `2db00d36-98bc-80d0-9bd0-c449fbb26645` の部分がデータベースIDです
   - **ハイフン（`-`）を含む形式の場合、そのまま使用してください**
   - 例: `NOTION_DATABASE_ID=2db00d36-98bc-80d0-9bd0-c449fbb26645`

**方法B: ハイフンを削除する場合**

1. URLから取得したIDからハイフンを削除
   - 例: `2db00d36-98bc-80d0-9bd0-c449fbb26645` → `2db00d3698bc80d09bd0c449fbb26645`
2. 32文字の英数字になります

**どちらを使うべきか？**
- 通常は**方法A（ハイフンを含む形式）**をそのまま使用することを推奨します
- もし方法Aでエラーが出る場合は、方法Bを試してください

3. このIDをメモしておきます（後で環境変数に設定します）

#### ステップ4: Integrationの接続（重要！）

**この手順を忘れると、アプリからデータベースにアクセスできません！**

1. **データベースページを開く**
   - 作成したデータベースのページを開きます

2. **Connectionsメニューを開く**
   - データベースページの右上にある「...」（三点リーダー）メニューをクリック
   - または、ページの右上にある「Share」ボタンをクリック

3. **Integrationを接続**
   - 「Connections」タブを選択（「Share」ダイアログが開いている場合）
   - または、メニューから「Connections」を選択
   - 「Add connections」または「Connect」ボタンをクリック
   - ステップ2で作成したIntegration（例: "説明書管理アプリ"）を選択
   - Integrationの横にチェックマークが表示されれば接続成功です

4. **接続の確認**
   - Integrationが接続されると、データベースページの右上にIntegrationのアイコンが表示されます
   - または、「Connections」セクションにIntegration名が表示されます

**重要**: 
- データベースが親ページの中にある場合、**親ページにもIntegrationを接続する必要がある場合があります**
- データベースページ自体に必ずIntegrationを接続してください

これでデータベースの準備が完了です！

### 4. 環境変数の設定

`.env.local.example` を `.env.local` にコピーして、値を設定：

```bash
cp .env.local.example .env.local
```

`.env.local` を編集：

```env
NOTION_API_KEY=secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
NOTION_DATABASE_ID=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

### 5. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで [http://localhost:3000](http://localhost:3000) を開きます。

## デプロイ（Vercel）

### 1. Vercelにプロジェクトをインポート

1. [Vercel](https://vercel.com) にログイン
2. 「Add New Project」をクリック
3. GitHubリポジトリを選択（または手動でアップロード）

### 2. 環境変数の設定

Vercelのプロジェクト設定で環境変数を追加：

- `NOTION_API_KEY`: Notion Integration Token
- `NOTION_DATABASE_ID`: NotionデータベースID

### 3. デプロイ

「Deploy」をクリックしてデプロイを開始します。

## 使い方

### 説明書の追加

1. トップページの「+ 新規追加」ボタンをクリック
2. 製品名を入力（必須）
3. 説明書URLがある場合は入力、ない場合は画像をアップロード
4. 購入日やカテゴリを入力（任意）
5. 「保存」をクリック

### 画像のアップロード

- **PC**: 「カメラで撮影 / ファイルを選択」ボタンから画像ファイルを選択
- **モバイル**: ボタンをタップするとカメラが起動します

### 説明書の編集・削除

一覧ページの各カードにある「編集」または「削除」ボタンから操作できます。

## 注意事項

### 画像アップロードについて

現在の実装では、画像はBase64形式でNotionに保存されます。Notion APIは直接Base64アップロードをサポートしていないため、実際のプロダクション環境では以下の対応を推奨します：

1. **Cloudinary**などの外部ストレージサービスを使用
2. 画像をCloudinaryにアップロード
3. 取得したURLをNotionに保存

### 無料枠の制約

- **Vercel**: 100GB帯域/月（個人利用なら十分）
- **Notion API**: レート制限あり（3リクエスト/秒）
- **画像サイズ**: Notionは10MB制限

## トラブルシューティング

### 「Could not find database」エラーが発生する場合

このエラーは、Integrationがデータベースに接続されていない場合に発生します。

**解決方法：**

1. **データベースページでIntegrationを接続**
   - データベースページを開く
   - 右上の「...」メニューまたは「Share」ボタンをクリック
   - 「Connections」タブを選択
   - 「Add connections」をクリック
   - 作成したIntegrationを選択して接続

2. **親ページにも接続が必要な場合**
   - データベースが親ページの中にある場合、親ページにもIntegrationを接続する必要がある場合があります
   - 親ページでも同様に「Connections」からIntegrationを接続してください

3. **データベースIDの確認**
   - `.env.local`ファイルの`NOTION_DATABASE_ID`が正しいか確認
   - データベースのURLから32文字のIDを正しく取得しているか確認
   - ハイフン（`-`）が含まれている場合は、そのまま含めてください

4. **開発サーバーの再起動**
   - 環境変数を変更した後は、開発サーバーを再起動してください
   ```bash
   # Ctrl+Cで停止してから
   npm run dev
   ```

### 「API token is invalid」エラーが発生する場合

1. `.env.local`ファイルの`NOTION_API_KEY`が正しいか確認
2. API Keyは`ntn_`または`secret_`で始まる文字列です
3. 余分なスペースや改行が含まれていないか確認
4. 開発サーバーを再起動して環境変数を再読み込み

### Notion APIエラーが発生する場合

1. Integration Tokenが正しく設定されているか確認
2. データベースIDが正しいか確認
3. Integrationがデータベースに接続されているか確認
4. Integrationの権限設定を確認（読み取り・書き込み権限が必要）

### 画像が表示されない場合

- 画像サイズが10MBを超えていないか確認
- ブラウザのコンソールでエラーを確認
- Notion APIは直接Base64アップロードをサポートしていないため、画像は外部URLとして保存する必要があります

## ライセンス

ISC
